# Заявки лендинга в Notion

Заявки с формы «Записаться» сохраняются в таблицу Notion со статусом **Не оплачено** / **Оплачено**.

## 1. Токен Notion (Integration)

1. Зайдите на [Notion → My integrations](https://www.notion.so/my-integrations).
2. **New integration** → название (например «Cursor Landing») → **Submit**.
3. Скопируйте **Internal Integration Secret** (токен начинается с `secret_`).

## 2. Таблица в Notion

Создайте таблицу (или откройте существующую). В ней должны быть **колонки с такими именами**:

| Имя колонки | Тип в Notion |
|-------------|----------------|
| Name        | Title (обычная первая колонка) |
| Email       | Email |
| Phone       | Phone |
| Сумма       | Number |
| Status      | Select (варианты: **Не оплачено**, **Оплачено**) |
| Date        | Date |

Если таблица уже есть по ссылке [ваша таблица](https://www.notion.so/30c59203544880e19b8af372b6c731d4?v=30c592035448800c9b08000cde8a4098) — нужны свойства с **точными именами**: Name, Email, Phone, Сумма, Status, Date.

## 3. Доступ интеграции к таблице

1. Откройте страницу/таблицу в Notion.
2. В правом верхнем углу нажмите **⋯** → **Connections** → **Connect to**.
3. Выберите вашу интеграцию (например «Cursor Landing»).

Без этого шага API не сможет записывать строки.

## 4. ID таблицы (Database ID)

В ссылке на таблицу уже есть ID:

- Полная ссылка: `https://www.notion.so/30c59203544880e19b8af372b6c731d4?v=...`
- **Database ID:** `30c59203544880e19b8af372b6c731d4` (уже прописан в коде по умолчанию).

Если используете другую таблицу — скопируйте из её URL часть между `notion.so/` и `?`.

## 5. Переменные в Netlify

В **Site settings → Environment variables** добавьте:

| Переменная           | Значение |
|----------------------|----------|
| `NOTION_API_KEY`     | Токен интеграции (Internal Integration Secret) |
| `NOTION_DATABASE_ID` | ID таблицы (по желанию, по умолчанию уже задан) |

После сохранения переменных сделайте **Trigger deploy** (redeploy).

## Статус «Оплачено»

При отправке формы новая строка создаётся со статусом **Не оплачено**. Чтобы менять на **Оплачено** после оплаты, нужно либо вручную менять в Notion, либо настроить webhook от платёжной системы (Stripe/ЮKassa), который будет вызывать API и обновлять строку в Notion.

## Если данные не попадают в Notion

1. **Vercel:** Зайди в проект → **Settings** → **Environment Variables**. Должны быть заданы **NOTION_API_KEY** и (при другой базе) **NOTION_DATABASE_ID** для окружения **Production**. После смены переменных сделай **Redeploy**.
2. **Notion — доступ:** Открой таблицу в Notion → **⋯** (правый верхний угол) → **Connections** → **Connect to** → выбери свою интеграцию. Без этого API не может писать в базу.
3. **Имена колонок:** В таблице должны быть свойства с **точными** именами: **Name**, **Email**, **Phone**, **Сумма**, **Status**, **Date** (как в таблице выше). Регистр и язык важны.
4. **Логи:** В Vercel → проект → **Logs** или **Deployments** → последний деплой → **Functions** → смотри вызовы `send-to-notion`. Там будет текст ошибки от Notion (например `validation_error`), по нему можно понять, какое поле не подходит.
