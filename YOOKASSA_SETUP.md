# Что найти в ЮKassa для возврата на страницу «Спасибо»

Чтобы после оплаты картой РФ клиент попадал на твою страницу с текстом «Спасибо за оплату!» и ссылкой на чат, нужны два значения из личного кабинета ЮKassa. Их нужно добавить в Vercel как переменные окружения.

---

## Список: что тебе нужно

| № | Что искать | Куда подставить |
|---|------------|-----------------|
| 1 | **Идентификатор магазина (Shop ID)** | В Vercel → переменная **YOOKASSA_SHOP_ID** |
| 2 | **Секретный ключ** | В Vercel → переменная **YOOKASSA_SECRET_KEY** |
| 3 | **URL твоего сайта** | В Vercel → переменная **SITE_URL** (например `https://cursorlearning.vercel.app`) |

---

## Пошаговая инструкция

### 1. Войти в личный кабинет ЮKassa

- Открой [yookassa.ru/my](https://yookassa.ru/my) и войди в свой аккаунт.
- Если магазинов несколько — в верхней панели выбери нужный магазин.

---

### 2. Найти идентификатор магазина (Shop ID)

- **Где:** в верхней части личного кабинета, рядом с названием магазина.
- Обычно это число из нескольких цифр (например `123456`).
- **Скопируй** это число — это твой **YOOKASSA_SHOP_ID**.

*Если не видишь Shop ID — он появляется после подписания договора с ЮKassa. В таком случае сначала заверши подключение магазина.*

---

### 3. Найти или выпустить секретный ключ

- В **левом меню** выбери **Настройки** (или **Интеграция**).
- Открой раздел **«Ключи API»** (или **«Секретные ключи»**).
- Если ключ уже есть — его можно скопировать (если интерфейс даёт такую возможность).
- Если ключа нет или нужен новый:
  - Нажми **«Выпустить ключ»** / **«Создать ключ»**.
  - Подтверди действие (часто приходит СМС с кодом).
  - **Сразу скопируй** появившийся ключ — он показывается **один раз**. После закрытия окна его снова увидеть нельзя.
- Это значение — твой **YOOKASSA_SECRET_KEY**.

---

### 4. Указать URL сайта (SITE_URL)

- Это не из ЮKassa, а твой реальный адрес сайта.
- Без `https://` в конце, например: `https://cursorlearning.vercel.app`.
- Эту же строку задай в Vercel как **SITE_URL**.

---

### 5. Добавить переменные в Vercel

1. Зайди в [vercel.com](https://vercel.com) → свой проект **cursorlearning**.
2. **Settings** → **Environment Variables**.
3. Добавь три переменные (для окружения **Production**, при необходимости и для Preview):

| Name | Value |
|------|--------|
| `YOOKASSA_SHOP_ID` | число из п. 2 |
| `YOOKASSA_SECRET_KEY` | ключ из п. 3 |
| `SITE_URL` | твой URL сайта из п. 4 |

4. Сохрани и сделай **Redeploy** последнего деплоя.

После этого при выборе «Карта РФ (ЮKassa)» и оплате клиент будет возвращаться на твою страницу `/thanks.html` с сообщением и ссылкой на чат.

---

## Письмо на email после оплаты (ЮKassa)

Чтобы после успешной оплаты картой РФ на почту клиента приходило письмо «Вы записаны на интенсив» и ссылка на чат в Telegram:

1. **Те же переменные, что для писем после Stripe** (см. [CONFIRMATION_AFTER_PAYMENT.md](CONFIRMATION_AFTER_PAYMENT.md)): **RESEND_API_KEY**, **CONFIRMATION_FROM_EMAIL**, **TELEGRAM_CHAT_LINK**. Если уже настроили для Stripe — ничего добавлять не нужно.
2. **Включи HTTP-уведомления в ЮKassa:**
   - Зайди в [yookassa.ru/my](https://yookassa.ru/my) → **Настройки** (или **Интеграция**) → **HTTP-уведомления**.
   - Либо напрямую: [Настройки HTTP-уведомлений](https://yookassa.ru/my/http-notifications-settings).
   - **URL для уведомлений:** `https://твой-домен.vercel.app/api/webhook-yookassa` (подставь свой домен).
   - Включи событие **payment.succeeded** («Платёж успешно завершён»).
   - Сохрани настройки.
3. Сделай **Redeploy** в Vercel (если только что добавил переменные).

После этого при успешной оплате ЮKassa будет вызывать твой webhook, и код отправит письмо на email, который клиент указал в форме (через Resend). На странице thanks.html клиент по-прежнему видит «Спасибо» и ссылку на чат.

---

## Как проверить, что на проде подтягивается нужное

Открой в браузере (подставь свой домен):

**https://твой-домен.vercel.app/api/check-yookassa**

Пример: если сайт на `https://cursorlearning.vercel.app`, открой  
**https://cursorlearning.vercel.app/api/check-yookassa**

В ответе будет JSON:
- **`yookassaApi: true`** — переменные на проде заданы, оплата картой РФ идёт через API ЮKassa (после оплаты — переход на thanks.html).
- **`yookassaApi: false`** — на проде используются статические ссылки; добавь переменные в Vercel и сделай Redeploy.
- **`timeInPayload: true`** — в заявки в таблицу уходит время (если в таблице его нет — обнови скрипт и развёртывание в Google Таблице).
